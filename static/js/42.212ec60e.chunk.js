"use strict";(self.webpackChunkzapper=self.webpackChunkzapper||[]).push([[42],{4042:(e,t,n)=>{n.r(t),n.d(t,{default:()=>yt});var r=n(5043),o=n(8911),a=n(1637),s=n(4858),i=n(5475),l=n(1337),c=n(4535),d=n(6446);const u=(0,c.Ay)(d.A)((()=>({padding:"1rem 0","@media screen and (max-width: 485px)":{padding:"0"}}))),p=(0,c.Ay)(d.A)((e=>{let{theme:t}=e;return{display:"flex",flexDirection:"column",gap:"1.5rem",padding:"1.5rem 2rem",borderTopLeftRadius:"24px",borderTopRightRadius:"24px",background:"light"===t.palette.mode?t.palette.background.default:`${t.palette.background.default}80`,width:"100%",maxWidth:"640px",margin:"0 auto",minHeight:"100%",border:"1px solid",borderImageSlice:1,borderImageSource:"dark"===t.palette.mode?"linear-gradient(180deg, rgba(255, 255, 255, 0.0169) 49.5%, rgba(255, 255, 255, 0.13) 100%)":"linear-gradient(180deg, rgba(100, 116, 139, 0.0091) 49.5%, rgba(100, 116, 139, 0.13) 100%)","@media screen and (max-width: 485px)":{padding:"1rem",background:"transparent"}}}));(0,c.Ay)(o.A)({width:"100%",alignItems:"flex-end",position:"relative","& > .info_btn":{position:"absolute",zIndex:1}});var h=n(5865),m=n(3037),x=n(1906),g=n(579);const f=(0,c.Ay)((e=>(0,g.jsx)(h.A,{...e,variant:"h1"})))({fontSize:"2rem",fontWeight:600,lineHeight:"38.72px",textAlign:"center",fontFamily:"InterDisplay"}),y=(0,c.Ay)((e=>(0,g.jsx)(o.A,{...e,component:"form"})))((()=>({maxWidth:"340px",width:"100%",margin:"0 auto",gap:"1rem"}))),j=(0,c.Ay)((e=>(0,g.jsx)(x.A,{...e,fullWidth:!0,variant:"contained"})))((e=>{let{theme:t}=e;return{borderRadius:"12px",boxShadow:"0px 2px 1px 0px #FFFFFF26 inset",padding:"15.5px 1rem",fontSize:"0.875rem",fontWeight:600,"&:disabled":{color:t.palette.text.secondary,cursor:"not-allowed"}}})),b=(0,c.Ay)((e=>(0,g.jsx)(h.A,{...e,variant:"caption"})))((e=>{let{theme:t}=e;return{textAlign:"center",color:`${t.palette.text.primary}B3`}}));var A=n(1046);const w=[{title:"Zap",value:A.X5},{title:"Anon zap",value:A.CA},{title:"Send sats",value:A.W0}];var v=n(6546),k=n(4056);const C=(0,c.Ay)((e=>(0,g.jsx)(v.A,{...e,classes:{flexContainer:"flexer"},scrollButtons:!0})))((()=>({"& .flexer":{justifyContent:"center"},"& .MuiTabs-indicator":{display:"none"}}))),S=(0,c.Ay)((e=>(0,g.jsx)(k.A,{...e,classes:{selected:"selected"}})))((e=>{let{theme:t}=e;return{textTransform:"initial",fontSize:"0.875rem",fontWeight:600,minHeight:"29px",minWidth:"fit-content",padding:"6px 16px",borderRadius:"10px",color:t.palette.text.secondary,flex:1,whiteSpace:"nowrap","&.selected":{color:t.palette.text.primary,background:`${t.palette.text.primary}1A`}}})),$=e=>{let{value:t,onChange:n}=e;return(0,g.jsx)(C,{value:t,onChange:n,children:w.map((e=>(0,g.jsx)(S,{value:e.value,label:e.title},e.value)))})};var R=n(1860),E=n(7392),z=n(2593);const N=(0,c.Ay)((0,r.forwardRef)(((e,t)=>(0,g.jsx)(R.Ay,{...e,inputRef:t,classes:{input:"input_root"}}))))((e=>{let{theme:t}=e;return{fontSize:"4rem",borderWidth:2,borderStyle:"solid",borderColor:`${t.palette.text.primary}21`,borderRadius:"12px","& .input_root":{textAlign:"center","&[type=number]":{"&::-webkit-outer-spin-button, &::-webkit-inner-spin-button":{WebkitAppearance:"none",margin:0},MozAppearance:"textfield"}},"@media screen and (max-width: 485px)":{fontSize:"3rem"},maxHeight:"initial",fontFamily:"InterDisplay"}})),W=(0,c.Ay)((e=>(0,g.jsx)(E.A,{...e,size:"small",children:(0,g.jsx)(z.cL,{})})))((e=>{let{theme:t}=e;return{position:"absolute",bottom:"0.25rem",right:"0.5rem",zIndex:1,width:"35px",height:"35px",color:t.palette.text.secondary,"&:is(&, :hover, :active)":{background:`${t.palette.background.default}B3`}}})),I=(0,r.forwardRef)(((e,t)=>{let{value:n,onChange:r,onIconClick:o,...a}=e;return(0,g.jsxs)(d.A,{position:"relative",children:[(0,g.jsx)(N,{value:n,onChange:r,onWheel:e=>{var t;return null===(t=e.target)||void 0===t?void 0:t.blur()},...a,ref:t}),(0,g.jsx)(W,{onClick:o})]})}));var D=n(1130);const Z=(0,c.Ay)((0,r.forwardRef)(((e,t)=>(0,g.jsx)(D.h,{...e,ref:t}))))((e=>{let{theme:t}=e;return{background:"transparent",width:"100%",outline:"none",resize:"none",padding:"0.75rem 1rem 2rem",borderRadius:"12px",borderWidth:2,borderStyle:"solid",borderColor:`${t.palette.text.primary}21`,color:t.palette.text.primary,fontWeight:600,fontSize:"0.875rem","&::placeholder":{color:`${t.palette.text.primary}4D`,fontWeight:600},"&::focus":{borderColor:`${t.palette.text.primary}`}}})),O=(0,c.Ay)((e=>(0,g.jsx)(E.A,{...e,size:"small",children:(0,g.jsx)(z.cL,{})})))((e=>{let{theme:t}=e;return{position:"absolute",bottom:"0.5rem",right:"0.5rem",zIndex:1,width:"35px",height:"35px",color:t.palette.text.secondary,"&:is(&, :hover, :active)":{background:`${t.palette.background.default}B3`}}})),B=(0,r.forwardRef)(((e,t)=>{let{onIconClick:n,...r}=e;return(0,g.jsxs)(d.A,{position:"relative",height:"auto",children:[(0,g.jsx)(Z,{...r,minRows:1,ref:t}),(0,g.jsx)(O,{onClick:n})]})}));var Q=n(1414);function F(e){let t=e;return(e=Math.floor(e/1e3))>=1&&(t=`${e}K`),(e=Math.floor(e/1e3))>=1&&(t=`${e}M`),t}function M(e){return(e/1e3).toLocaleString(void 0,{minimumFractionDigits:0})}const T=e=>Q.Qe.npubEncode(e),L=function(){return new Date(1e3*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)).toLocaleString()},_=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Intl.NumberFormat("en").format(e)},P=function(){return Number(String(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0).replace(/\D/g,""))},H=e=>{let t="";const n=e.reduce(((e,t)=>e+("done"===t.status?t.amount:0)),0),r=e.filter((e=>"done"===e.status)).length,o=e.filter((e=>"error"===e.status)).length,a=r===e.length?r:`${r}/${e.length}`;return t=`Sent ${M(n)} sats to ${a} recipients`,o&&(t+=`, ${o} errors`),t};var V=n(8903),K=n(4836),X=n(3529),Y=n(8375),G=n(6600),U=n(5316);const J=(0,c.Ay)((e=>(0,g.jsx)(Y.A,{...e,classes:{paper:"paper"},slotProps:{backdrop:{sx:{backdropFilter:"blur(5px)"}}},scroll:"body"})))((e=>{let{theme:t}=e;return{"& .paper":{margin:"1rem",borderRadius:"1.5rem",background:"light"===t.palette.mode?t.palette.background.default:"#090f34F2",borderWidth:"1px",borderStyle:"solid",borderColor:`${t.palette.text.primary}1A`}}})),q=(0,c.Ay)((e=>(0,g.jsx)(G.A,{...e,variant:"h1"})))((()=>({textAlign:"center",fontWeight:600,fontSize:"1.5rem","@media screen and (max-width: 485px)":{padding:"1rem",fontSize:"1rem"}}))),ee=(0,c.Ay)((e=>(0,g.jsx)(U.A,{...e})))((()=>({padding:"1.5rem 3rem 3rem",display:"flex",flexDirection:"column","@media screen and (max-width: 485px)":{padding:"1rem"}}))),te=(0,c.Ay)((e=>(0,g.jsx)(d.A,{...e})))((()=>({display:"flex",alignItems:"center",justifyContent:"flex-end",padding:"0.5rem 1rem",position:"relative","& > .close_btn":{position:"absolute",transform:"translateY(50%)"}}))),ne=(0,r.forwardRef)((function(e,t){return(0,g.jsx)(K.A,{direction:"up",ref:t,...e})})),re=e=>{let{open:t,onClose:n,onClickCloseIcon:r,children:o,title:a,...s}=e;return(0,g.jsxs)(J,{...s,open:t,onClose:n,TransitionComponent:ne,children:[(0,g.jsx)(te,{children:(0,g.jsx)(E.A,{onClick:r,className:"close_btn",children:(0,g.jsx)(X.A,{})})}),a&&(0,g.jsx)(q,{children:a}),(0,g.jsx)(ee,{children:o})]})},oe=(0,c.Ay)((e=>{const t=new Set(["active"]),n=Object.fromEntries(Object.entries(e).filter((e=>!t.has(e[0]))));return(0,g.jsx)(x.A,{...n,fullWidth:!0,variant:"outlined",color:"secondary"})}))((e=>{let{theme:t,active:n=!1}=e;return{color:t.palette.text.primary,background:n?`${t.palette.text.primary}26`:"transparent","@media screen and (max-width: 485px)":{fontSize:"0.75rem"}}}));var ae=n(344);const se=e=>{let{open:t,onClose:n,pickedComment:r,onPickComment:a}=e;return(0,g.jsx)(re,{open:t,onClose:n,onClickCloseIcon:n,title:"Pick a comment",children:(0,g.jsxs)(o.A,{gap:"1rem",children:[(0,g.jsx)(V.Ay,{container:!0,rowSpacing:1,columnSpacing:1,columns:2,children:ae.r_.map((e=>(0,g.jsx)(V.Ay,{item:!0,xs:1,children:(0,g.jsx)(oe,{active:r===e,onClick:()=>(e=>{a(e),n()})(e),children:e})},e)))}),(0,g.jsx)(x.A,{onClick:n,color:"secondary",children:"Cancel"})]})})},ie=(0,c.Ay)((e=>{const t=new Set(["active"]),n=Object.fromEntries(Object.entries(e).filter((e=>!t.has(e[0]))));return(0,g.jsx)(x.A,{...n,fullWidth:!0,variant:"outlined",color:"secondary"})}))((e=>{let{theme:t,active:n=!1}=e;return{color:t.palette.text.primary,background:n?`${t.palette.text.primary}26`:"transparent"}})),le=e=>{let{open:t,onClose:n,onPickAmount:r,pickedAmount:a}=e;return(0,g.jsx)(re,{open:t,onClose:n,onClickCloseIcon:n,title:"Pick an amount",children:(0,g.jsxs)(o.A,{gap:"1rem",children:[(0,g.jsx)(V.Ay,{container:!0,rowSpacing:1,columnSpacing:1,columns:2,children:ae.SL.map((e=>{let[t,o]=e;return(0,g.jsx)(V.Ay,{item:!0,xs:1,children:(0,g.jsxs)(ie,{active:a===t,onClick:()=>(r(t),void n()),children:[F(t)," ",o]})},t)}))}),(0,g.jsx)(x.A,{onClick:n,color:"secondary",children:"Cancel"})]})})};(0,m.Ts)({appName:"Zapper"});const ce=e=>{let{onTypeChange:t,type:n,onSubmit:a,zaps:i,currentZap:l,onRetrySend:c}=e;const{register:d,handleSubmit:u,watch:p,control:x,setValue:w}=(0,s.xW)(),v=i.length,[k,C]=(0,r.useState)(!1),[S,R]=(0,r.useState)(!1),[E,z]=(0,r.useState)(!!window.webln),[N,W]=(0,r.useState)(!!window.webln),D=p("amount"),Z=p("comment"),O=((e,t,n)=>{if(!e)return"Specify amount first";let r="";return t!==A.X5&&t!==A.CA||(r="Zap"),t===A.W0&&(r="Send"),r+=` ${_(e)} sats`,n>1&&(r+=` to ${n} recipients`),r})(D,n,v),Q=e=>{const t=P(D);"ArrowUp"===e.key?w("amount",t+1):"ArrowDown"===e.key&&w("amount",t<=0?0:t-1)};(0,r.useEffect)((()=>{document.addEventListener("webln:connected",(()=>{z(!0),W(!!window.webln)}))}));const F=n!==A.W0,M=!i.find((e=>e.status!==ae.$Q.DONE)),T=!i.find((e=>e.status)),L=(e=>e===A.X5?"Zap will be published on Nostr under your name.":e===A.CA?"Zap will be published on Nostr anonymously.":"No event will be published on Nostr.")(n);return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)(o.A,{gap:"1.5rem",children:[(0,g.jsx)(f,{children:"Send a payment"}),(0,g.jsxs)(y,{onSubmit:u(a),children:[(0,g.jsx)($,{value:n,onChange:t}),(0,g.jsx)(s.xI,{name:"amount",control:x,render:e=>{let{field:t}=e;const n=_(t.value);return(0,g.jsx)(I,{...t,value:n,onChange:e=>((e,t)=>{const n=e[e.length-1];return void 0===n?t(""):/^\d*$/.test(n)?t(P(e)):void 0})(e.target.value,t.onChange),onKeyDown:Q,placeholder:"0",autoComplete:"off",onIconClick:()=>C(!0)})}}),F&&(0,g.jsx)(B,{onIconClick:()=>R(!0),...d("comment"),placeholder:"Comment"}),T&&(0,g.jsxs)(g.Fragment,{children:[(N||!E)&&(0,g.jsxs)("center",{children:[(0,g.jsx)(m.$n,{onConnected:e=>{W(!!e),window.webln=e,(0,A.EO)(!!e)},onDisconnected:()=>{W(!1),(0,A.EO)(!1),window.webln=void 0}}),!N&&(0,g.jsx)(b,{children:"or proceed with QR codes"})]}),(0,g.jsx)(j,{type:"submit",disabled:!D||!v,children:O}),(0,g.jsx)(b,{children:L})]}),!T&&(0,g.jsxs)(o.A,{gap:"0.5rem",children:[(0,g.jsx)(h.A,{textAlign:"center",variant:"h5",fontWeight:600,children:H(i)}),!M&&!l&&(0,g.jsx)(j,{type:"button",onClick:c,children:"Retry unsent zaps"})]})]})]}),(0,g.jsx)(se,{open:S,onClose:()=>R(!1),pickedComment:Z,onPickComment:e=>w("comment",e)}),(0,g.jsx)(le,{open:k,onClose:()=>C(!1),pickedAmount:D,onPickAmount:e=>w("amount",e)})]})};var de=n(6258);const ue=(0,c.Ay)((e=>(0,g.jsx)(x.A,{variant:"text",...e,endIcon:(0,g.jsx)(z.ZL,{})})))((e=>{let{theme:t}=e;return{color:`${t.palette.text.primary}B3`,fontSize:"0.75rem",padding:"0 0.25rem",boxShadow:"none","& .MuiButton-endIcon":{marginRight:0},"&:hover":{background:"transparent",boxShadow:"none"}}})),pe=(0,c.Ay)("pre")((e=>{let{theme:t}=e;return{overflowY:"scroll",height:"300px",background:`${t.palette.text.primary}0D`,padding:"0.5rem 1rem",borderRadius:"10px",fontSize:"0.75rem"}})),he=(0,c.Ay)((e=>(0,g.jsx)(h.A,{...e})))((e=>{let{theme:t}=e;return{color:t.palette.text.primary,wordBreak:"break-all"}})),me=(0,c.Ay)((e=>(0,g.jsx)(h.A,{...e,variant:"caption"})))((e=>{let{theme:t}=e;return{color:t.palette.text.secondary}}));var xe=n(8554);const ge=e=>{var t,n,r,o;return(null===(t=e.meta)||void 0===t||null===(n=t.profile)||void 0===n?void 0:n.display_name)||(null===(r=e.meta)||void 0===r||null===(o=r.profile)||void 0===o?void 0:o.name)||(e=>{const t=Q.Qe.npubEncode(e);return`${t.substring(0,10)}...${t.substring(t.length-4)}`})(e.pubkey)};var fe=n(587);const ye=(0,c.Ay)((e=>(0,g.jsx)(o.A,{...e,direction:"row"})))((()=>({alignItems:"center",gap:"1rem",textDecoration:"none"}))),je=(0,c.Ay)((e=>(0,g.jsx)(h.A,{...e})))((e=>{let{theme:t}=e;return{fontSize:"0.875rem",fontWeight:600,color:t.palette.text.primary,"&:hover":{textDecoration:"underline"}}})),be=(0,c.Ay)((e=>{const t=new Set(["withBorder"]),n=Object.fromEntries(Object.entries(e).filter((e=>!t.has(e[0]))));return(0,g.jsx)(fe.A,{...n})}))((e=>{let{withBorder:t=!1,theme:n,variant:r}=e;const o={width:48,height:48,border:t?`2px solid ${n.palette.text.primary}`:"none"};return"rounded"===r?{...o,borderRadius:"12px"}:o})),Ae=(0,r.memo)((function(e){var t,n;let{profile:r,withUserName:o=!0,withBorder:a=!1}=e;const s=(0,xe.c)({pubkey:r.pubkey,originalImage:null===(t=r.meta)||void 0===t||null===(n=t.profile)||void 0===n?void 0:n.picture}),i=ge(r),l=`nostr:${T(r.pubkey)}`;return(0,g.jsxs)(ye,{component:"a",href:l,target:"_blank",children:[(0,g.jsx)(be,{variant:"rounded",src:s,alt:i,title:i,withBorder:a}),o&&(0,g.jsx)(je,{children:i})]})})),we=e=>1===e.kind?e.content:30023===e.kind?A.d2.getTagValue(e,"title")||A.d2.getTagValue(e,"summary"):`Kind: ${e.kind}. ${A.d2.getTagValue(e,"alt")}`,ve=e=>{let{target:t}=e;const[n,a]=(0,r.useState)(!1);return(0,g.jsxs)(o.A,{gap:"1rem",children:[(0,g.jsx)(o.A,{alignItems:"center",children:(0,g.jsx)(ue,{onClick:()=>a((e=>!e)),children:"Event details"})}),(0,g.jsx)(de.A,{in:n,unmountOnExit:!0,children:(0,g.jsxs)(o.A,{gap:"1rem",children:[t&&(0,g.jsxs)(o.A,{gap:"0.25rem",children:[(0,g.jsx)(Ae,{profile:t}),(0,g.jsx)(he,{children:we(t)}),(0,g.jsx)(me,{children:L(t.created_at)})]}),(0,g.jsx)(pe,{children:t?JSON.stringify({id:t.id,pubkey:t.pubkey,kind:t.kind,created_at:t.created_at,tags:t.tags,content:t.content,sig:t.sig},null,2):"No details"})]})})]})};var ke=n(3768);var Ce=n(4194);const Se=(0,c.Ay)((0,r.forwardRef)(((e,t)=>(0,g.jsx)(Ce.A,{...e,ref:t,icon:!1}))))((e=>{let{theme:t}=e;return{width:"100%",maxHeight:72,padding:"1rem",background:"dark"===t.palette.mode?"#292E4E":t.palette.background.paper,borderRadius:12,maxWidth:"409px",margin:"0 0.5rem",boxShadow:t.shadows[10],"& .MuiAlert-message":{display:"flex",minWidth:"100%",justifyContent:"space-between",overflow:"hidden",padding:0}}})),$e=(0,c.Ay)(d.A)((()=>({display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",width:"100%","& > .MuiTypography-root":{flex:1,width:"100%",wordBreak:"break-word",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",fontWeight:500}}))),Re=(0,c.Ay)((e=>{const t=new Set(["type"]),n=Object.fromEntries(Object.entries(e).filter((e=>!t.has(e[0]))));return(0,g.jsx)(d.A,{...n})}))((e=>{let{type:t="success"}=e;return{padding:"0.5rem",borderRadius:"12px",background:"success"===t?"#047857":"#B91C1C"}})),Ee=(0,c.Ay)(E.A)({borderRadius:"10px"}),ze=(0,r.forwardRef)(((e,t)=>{let{type:n="success",message:r,onDismiss:o}=e;return(0,g.jsx)(Se,{ref:t,children:(0,g.jsxs)($e,{children:[(0,g.jsx)(Re,{type:n,children:"success"===n?(0,g.jsx)(z.UH,{}):(0,g.jsx)(z.Rg,{})}),(0,g.jsx)(h.A,{fontSize:"0.875rem",fontWeight:400,children:r}),(0,g.jsx)(Ee,{onClick:o,color:"inherit",children:(0,g.jsx)(X.A,{color:"inherit"})})]})})})),Ne=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A.X5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const[o,a]=(0,i.ok)(),[s,l]=(0,r.useState)(!0),[c,d]=(0,r.useState)(""),[u,p]=(0,r.useState)(!1),h=o.get("id")||"",[m,x]=(0,r.useState)(!1),[f,y]=(0,r.useState)(null),[j,b]=(0,r.useState)([]),[w,v]=(0,r.useState)([]),[k,C]=(0,r.useState)([]),[S,$]=(0,r.useState)([]),[R,E]=(0,r.useState)(""),[z,N]=(0,r.useState)(0),[W,I]=(0,r.useState)(-1),[D,Z]=(0,r.useState)(!1),O=(0,r.useRef)(),B=e=>{N(e),O.current=setTimeout((()=>{e>1?B(e-1):(N(0),F())}),1e3)};(0,r.useEffect)((()=>{"true"===o.get("auto_send")&&x(!0)}),[o]),(0,r.useEffect)((()=>{m&&(o.delete("auto_send"),a(o,{replace:!0}))}),[m]),(0,r.useEffect)((()=>{(async()=>{if(!(h||o.get("id")))return d("Specify id");try{p(!1),d(""),l(!0);const e=await(async e=>{if(!e)throw new Error("Specify id");const t=[];let n="",r=["wss://relay.nostr.band/"];const{type:o,data:a}=Q.Qe.decode(e);switch(o){case"npub":t.push({pubkey:a,weight:1});break;case"nprofile":t.push({pubkey:a.pubkey,weight:1}),r.push(...a.relays||[]);break;case"note":case"nrelay":n=a;break;case"nevent":n=a.id,r.push(...a.relays||[]);break;case"naddr":n=`${a.kind}:${a.pubkey}:${a.identifier}`,r.push(...a.relays||[]);break;default:throw new Error(`Bad id ${e}`)}r=r.filter((e=>""!==e));let s=await A.d2.getNDK(r),i=null;if(""!==n){if(n.toLowerCase().startsWith("wss://"))throw new Error("Nrelay not supported yet");if(n.includes(":")){if(i=await A.d2.fetchEventByAddr(s,n),!i)throw new Error(`Failed to fetch target event by addr ${n}`)}else if(i=await A.d2.fetchEventById(s,n),!i)throw new Error(`Failed to fetch target event by id ${n}`)}if(i){const e=i.tags.filter((e=>e.length>=2&&"zap"===e[0]));e.length?(e.forEach((e=>{e.length>=3&&""!==e[2]&&r.push(e[2]);const n=e[1],o=e.length>=4?Number(e[3]):0;t.push({pubkey:n,weight:o})})),t.find((e=>e.weight>0))||t.forEach((e=>{e.weight=1})),s=await A.d2.getNDK(r)):t.push({pubkey:i.pubkey,weight:1})}if(0===t.length)throw new Error("No zap target found");const l=t.map((e=>e.pubkey));i&&l.push(i.pubkey);const c=await A.d2.fetchMetas(s,l);return i&&(i.meta=c.find((e=>e.pubkey===i.pubkey))),{relays:[...new Set(r)],targets:t,metas:c,targetEvent:i}})(h),{targets:t,targetEvent:n,relays:r,metas:o}=e;C(o),b(t),v(r),n&&y(n),l(!1),p(!0)}catch(c){d(c.message),l(!1)}})()}),[h]),(0,r.useEffect)((()=>()=>{p(!1),l(!1)}),[]),(0,r.useEffect)((()=>{k.length>0&&j.length>0&&(async()=>{try{const r=await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:A.X5,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";const i=await A.d2.getNDK([]),l=t.reduce(((e,t)=>e+t.weight),0);return t.map(((t,c)=>{const d=t.weight/l,u=Math.floor(1e3*a*d);return{index:c,zap:A.d2.createZap(i,{amount:a,comment:s,relays:n,msats:u,pubkey:t.pubkey,target:e}),weight:d,meta:r.find((e=>e.pubkey===t.pubkey)),type:o,pubkey:t.pubkey,amount:u,comment:s,status:""}}))}(f,j,w,k,e,t,n);$(r),t>0&&r.length>0&&m&&(B(3),x(!1))}catch(c){d(c.message)}})()}),[f,j,k,t,e,n]);const F=()=>{setTimeout((()=>document.getElementById("send").click()),0)},T=e=>{E((t=>`${t}\n${e}`))},L=e=>{const t={...e};$((n=>(n.splice(e.index,1,t),[...n])))},_=async e=>{I(e.index);const t=await A.d2.sendZap(e,T,L);return e.status===ae.$Q.DONE&&ke.Ay.custom((t=>(0,g.jsx)(ze,{message:`Sent ${M(e.amount)} sats`,onDismiss:()=>ke.Ay.remove(t.id),type:"success"}))),t},P=async()=>{const e=S.find((e=>!e.status));if(!e)return I(-1),void Z(S.length>0);await _(e),e.cancelled||e.status!==ae.$Q.DONE&&e.status!==ae.$Q.ERROR||!A.d2.hasWebLN()||F()},H=W>=0?S[W]:null,V=()=>{H.status===ae.$Q.DONE||H.status===ae.$Q.ERROR||H.status===ae.$Q.WAITING||H.cancelled?I(-1):(0,A.QA)()},K=(0,r.useCallback)((e=>{e.status!==ae.$Q.DONE&&(e.status="",L(e),_(e))}),[]);return{isLoading:s,error:c,zaps:(0,r.useMemo)((()=>S),[S]),target:f,sendNextZap:P,doneCurrentZap:()=>{H.status=ae.$Q.DONE,L(H),S.find((e=>!e.status))?P():1===S.length&&V()},cancelCurrentZap:V,currentZap:H,logs:R,autoSendTimer:z,cancelAutoSend:()=>{(O.current||0===O.current)&&clearTimeout(O.current),N(0)},showDone:D,handleHideSuccessModal:()=>{Z(!1)},restartFailedZaps:()=>{$((e=>e.map((e=>(e.status!==ae.$Q.DONE&&(e.status=""),e))))),P()},restartZap:K,isLoaded:u}};var We=n(3336);const Ie=(0,c.Ay)((e=>(0,g.jsx)(We.A,{...e})))((e=>{let{theme:t}=e;return{borderRadius:"10px",padding:"2rem 1rem",maxWidth:"40rem",margin:"0 auto",display:"flex",flexDirection:"column",gap:"1rem",background:"light"===t.palette.mode?t.palette.background.default:`${t.palette.background.default}B3`}})),De=e=>{let{error:t}=e;return(0,g.jsx)(d.A,{children:(0,g.jsxs)(Ie,{children:[(0,g.jsx)(h.A,{variant:"h5",children:"Oops... Something went wrong"}),(0,g.jsx)("div",{children:t}),(0,g.jsx)(x.A,{onClick:()=>window.location.reload(),variant:"contained",children:"Retry"})]})})};var Ze=n(5721),Oe=n(3695),Be=n(2595),Qe=n(2989),Fe=n(3525),Me=n(8738),Te=n(1322);const Le=(0,c.Ay)(Te.Ay)((e=>{let{theme:t}=e;return{display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:`1px solid ${t.palette.text.primary}21`,padding:"0.5rem 0","&.toggle:not(:hover) .copy_btn":{display:"none"}}})),_e=(0,c.Ay)(h.A)((e=>{let{theme:t}=e;return{fontSize:"0.875rem",color:t.palette.text.secondary,fontWeight:500}})),Pe=(0,c.Ay)((e=>(0,g.jsx)(E.A,{...e,classes:{root:"copy_btn"},children:(0,g.jsx)(z.Td,{})})))((e=>{let{theme:t}=e;return{"&.copy_btn":{color:t.palette.text.secondary}}})),He=(0,r.memo)((function(e){let{handleCopy:t}=e;return(0,g.jsx)(Pe,{onClick:t})})),Ve=(0,r.memo)((function(e){let{weightPercentage:t}=e;return(0,g.jsxs)(h.A,{variant:"body2",fontWeight:500,children:[t,"%"]})})),Ke=Me.Fr||Me.v1?"always":"toggle",Xe=e=>{let{zap:t,isNewZap:n,onRestartZap:a}=e;const{weight:s=0,amount:i=0,pubkey:c,meta:d,status:u}=t,p=(0,r.useMemo)((()=>Math.round(100*s)),[s]),h=(0,r.useMemo)((()=>M(i)),[i]),m=(0,r.useMemo)((()=>T(c)),[c]),x=(0,r.useMemo)((()=>({pubkey:c,meta:d})),[c,d]),[f,y]=(0,l.Cj)(),j=(0,r.useCallback)((()=>{y(m),ke.Ay.success("Copied!")}),[y,m]),b=(0,r.useMemo)((()=>((e,t)=>{switch(e){case"":return!t&&(0,g.jsx)(Oe.A,{});case"paying":case"waiting":return(0,g.jsx)(Be.A,{});case"error":return(0,g.jsx)(Qe.A,{color:"error"});case"done":return(0,g.jsx)(Fe.A,{color:"success"});default:return null}})(u,n)),[u,n]);return(0,g.jsxs)(Le,{className:Ke,children:[(0,g.jsx)(Ae,{profile:x}),(0,g.jsxs)(o.A,{direction:"row",alignItems:"center",gap:"1rem",children:[(0,g.jsx)(He,{handleCopy:j}),(0,g.jsxs)(o.A,{children:[(0,g.jsx)(Ve,{weightPercentage:p}),(0,g.jsxs)(_e,{children:[h," sats"]})]}),b&&(0,g.jsx)(E.A,{onClick:()=>a(t),children:b})]})]})},Ye=(0,r.memo)((e=>{let{recipients:t=[],isNewZap:n,onRestartZap:r}=e;return(0,g.jsx)(Ze.A,{children:t.map((e=>(0,g.jsx)(Xe,{zap:e,onRestartZap:r,isNewZap:n},e.pubkey)))})})),Ge=(0,c.Ay)((e=>(0,g.jsx)(h.A,{...e})))({fontSize:"21px",fontWeight:600,textAlign:"center"}),Ue=(0,r.memo)((e=>{let{recipients:t=[],isNewZap:n,onRestartZap:r}=e;const a=t.length>1?"Recipients":"Recipient";return(0,g.jsxs)(o.A,{gap:"1rem",children:[(0,g.jsx)(Ge,{children:a}),(0,g.jsx)(Ye,{isNewZap:n,recipients:t,onRestartZap:r})]})}));var Je=n(4493),qe=n(8970),et=n(611);const tt=(0,c.Ay)((e=>(0,g.jsx)(h.A,{...e})))((()=>({fontWeight:600,fontSize:"1.125rem",textAlign:"center","@media screen and (max-width: 485px)":{fontSize:"1rem"}}))),nt=(0,c.Ay)((e=>(0,g.jsx)(h.A,{...e})))((e=>{let{theme:t}=e;return{fontWeight:400,fontSize:"0.75rem",color:t.palette.text.secondary}})),rt=(0,c.Ay)((e=>(0,g.jsx)(R.Ay,{...e,fullWidth:!0,readOnly:!0,classes:{input:"input"}})))((e=>{let{theme:t}=e;return{borderWidth:"2px",borderStyle:"solid",borderColor:`${t.palette.text.primary}21`,borderRadius:"12px",height:"41px","& .input":{padding:"0.75rem 1rem",color:t.palette.text.primary}}})),ot=(0,c.Ay)((e=>(0,g.jsx)(E.A,{...e})))((e=>{let{theme:t}=e;return{background:`${t.palette.text.primary}21`,color:t.palette.text.primary,minWidth:"41px",height:"41px",borderRadius:"12px"}})),at=(0,c.Ay)(x.A)((e=>{let{theme:t}=e;return{"&:is(&, :hover)":{color:"#fff"}}})),st=(0,c.Ay)((0,r.forwardRef)(((e,t)=>(0,g.jsx)(o.A,{...e,ref:t,alignItems:"center"}))))((()=>({"& > #canvas":{width:"100% !important",aspectRatio:"1/1",height:"auto !important"}}))),it=(0,c.Ay)((e=>(0,g.jsx)(et.A,{...e,variant:"determinate"})))((()=>({width:"100%",borderRadius:"24px"}))),lt=(0,c.Ay)((e=>(0,g.jsx)(h.A,{...e,variant:"caption"})))((e=>{let{theme:t}=e;return{textAlign:"center",color:`${t.palette.text.primary}B3`}}));function ct(e,t){const n=e/t*100;return Math.round(n)}const dt=e=>{let{currentZap:t,zaps:n,onDone:a,onClose:s}=e;const[i,c]=(0,r.useState)(!1),[d,u]=(0,l.Cj)(),p=!n.find((e=>!e.status));(0,r.useEffect)((()=>{if(!i||!t.invoice)return;const e=document.getElementById("canvas");qe.toCanvas(e,t.invoice,{width:"100%"},(e=>{e&&(ke.Ay.error("Failed to create QR code"),console.error("qr code error",e))}))}),[i,t]);const m=(0,r.useCallback)((()=>{switch(t.status){case ae.$Q.INVOICE:return"Fetching invoice...";case ae.$Q.PAYING:return"Sending sats...";case ae.$Q.DONE:return"Sent!";case ae.$Q.ERROR:return`Error: ${t.error}`;default:return""}}),[t]),f=(0,r.useCallback)((()=>t.status===ae.$Q.ERROR?"Close":t.status===ae.$Q.DONE?"Done":"Cancel"),[t]),y=M(t.amount),j=(()=>{try{const{lud06:e,lud16:n}=JSON.parse(t.meta.content);return n||e}catch(e){return console.log("Bad meta",e),""}})(),b=m(),w=f(),v=t.status===ae.$Q.DONE,k=t.invoice&&!t.cancelled&&(t.status===ae.$Q.WAITING||t.status===ae.$Q.ERROR),C=t.status===ae.$Q.ERROR,S=()=>{u(t.invoice),ke.Ay.success("Copied!")};return(0,g.jsxs)(o.A,{gap:"1rem",children:[(0,g.jsxs)(o.A,{gap:"1rem",alignItems:"center",children:[(0,g.jsx)(it,{value:ct(t.index+1,n.length)}),(0,g.jsxs)(tt,{children:[y," sats"," ",j&&(0,g.jsxs)(g.Fragment,{children:["to ",j.substring(0,Math.min(j.length,25)),"..."]})]}),(0,g.jsx)(Ae,{profile:t,withBorder:!0}),t.comment&&(0,g.jsx)(h.A,{children:t.comment}),b&&(0,g.jsx)(nt,{children:b}),(k||C)&&(0,g.jsxs)(o.A,{gap:"1rem",width:"100%",children:[!C&&(0,g.jsxs)(g.Fragment,{children:[!A.d2.hasWebLN()&&(0,g.jsx)(lt,{children:"Please pay the invoice:"}),(0,g.jsxs)(o.A,{direction:"row",gap:"0.5rem",children:[(0,g.jsx)(rt,{value:t.invoice}),(0,g.jsx)(ot,{onClick:S,children:(0,g.jsx)(z.Td,{})}),(0,g.jsx)(ot,{onClick:()=>c(!i),children:(0,g.jsx)(z.M6,{})})]}),(0,g.jsx)(de.A,{in:i,unmountOnExit:!0,children:(0,g.jsx)(st,{onClick:S,children:(0,g.jsx)("canvas",{id:"canvas"})})})]}),(0,g.jsxs)(o.A,{direction:"row",gap:"0.5rem",children:[!C&&(0,g.jsx)(at,{fullWidth:!0,href:`lightning:${t.invoice}`,target:"_blank",children:"Open Wallet"}),(0,g.jsx)(x.A,{fullWidth:!0,color:"secondary",onClick:t.cancelled?s:a,children:p||t.cancelled?"Done":"Next"})]}),!C&&(0,g.jsxs)(lt,{children:['Pay with your wallet and then tap "',p?"Done":"Next",'".']}),v&&(0,g.jsx)(Je.A,{})]})]}),v&&(0,g.jsx)(x.A,{variant:"contained",color:"secondary",onClick:s,children:w})]})},ut=e=>{let{open:t,onClose:n,currentZap:o,zaps:a,onDone:s}=e;const i=a.length,l=(0,r.useCallback)((()=>{let e="Sending...";return i>1&&(e=`Sending ${o.index+1}/${i}...`),e}),[i,o]);return(0,g.jsx)(re,{open:t,onClickCloseIcon:n,title:l(),children:(0,g.jsx)(dt,{currentZap:o,zaps:a,onDone:s,onClose:n})})},pt=(0,c.Ay)((e=>(0,g.jsx)(x.A,{variant:"text",...e,endIcon:(0,g.jsx)(z.ZL,{})})))((e=>{let{theme:t}=e;return{color:`${t.palette.text.primary}B3`,fontSize:"0.75rem",padding:"0 0.25rem",boxShadow:"none","& .MuiButton-endIcon":{marginRight:0},"&:hover":{background:"transparent",boxShadow:"none"}}})),ht=(0,c.Ay)("pre")((e=>{let{theme:t}=e;return{overflowY:"scroll",height:"300px",background:`${t.palette.text.primary}0D`,padding:"0.5rem 1rem",borderRadius:"10px",fontSize:"0.75rem"}})),mt=e=>{let{logs:t}=e;const[n,a]=(0,r.useState)(!1);return t&&t.length?(0,g.jsxs)(o.A,{gap:"1rem",children:[(0,g.jsx)(o.A,{alignItems:"center",children:(0,g.jsx)(pt,{onClick:()=>a((e=>!e)),children:"View logs"})}),(0,g.jsx)(de.A,{in:n,unmountOnExit:!0,children:(0,g.jsx)(ht,{children:t})})]}):null},xt=e=>{let{open:t,onClose:n,seconds:r}=e;return(0,g.jsx)(re,{open:t,onClickCloseIcon:n,title:`Auto zapping in ${r} seconds...`,children:(0,g.jsxs)(o.A,{gap:"1rem",children:[(0,g.jsx)(h.A,{fontWeight:500,fontSize:"1.25rem",textAlign:"center",children:"Click cancel to zap manually."}),(0,g.jsx)(x.A,{fullWidth:!0,onClick:n,children:"Cancel"})]})})};var gt=n(9778);const ft=e=>{let{open:t,onClose:n,hasErrors:r=!1}=e;return(0,g.jsx)(re,{open:t,onClose:n,onClickCloseIcon:n,title:"Zap finished",children:(0,g.jsxs)(o.A,{gap:"1rem",children:[(0,g.jsx)(h.A,{variant:"h1",fontSize:"1.5rem",textAlign:"center",children:r?"Done with errors":"Done!"}),(0,g.jsx)(o.A,{alignItems:"center",children:(0,g.jsx)(gt.A,{color:r?"warning":"success",fontSize:"large"})}),r&&(0,g.jsx)(h.A,{variant:"subtitle1",textAlign:"center",children:"You can view logs and retry with the failed recipients."})]})})},yt=()=>{const e=(0,s.mN)(),[t]=(0,i.ok)(),[n,c]=(0,r.useState)(A.CA),d=Number(e.watch("amount"))||0,h=(0,l.d7)(d,400),m=e.watch("comment"),x=(0,l.d7)(m,200);(0,r.useEffect)((()=>{document.addEventListener("nlAuth",(async e=>{const t="logout"!==e.detail.type;c(t?A.X5:A.CA)}))}),[]);const{isLoading:f,isLoaded:y,error:j,zaps:b,target:w,sendNextZap:v,cancelCurrentZap:k,doneCurrentZap:C,currentZap:S,logs:$,autoSendTimer:R,cancelAutoSend:E,showDone:z,handleHideSuccessModal:N,restartFailedZaps:W,restartZap:I}=Ne(n,h,x);if((0,r.useEffect)((()=>{const n=t.get("type")||A.CA;c(n);const r=Number(t.get("amount"))||0;e.setValue("amount",r);const o=t.get("comment")||"";e.setValue("comment",o)}),[t]),(0,r.useEffect)((()=>{y&&e.setFocus("amount")}),[y]),j)return(0,g.jsx)(De,{error:j});const D=!!b.find((e=>e.status===ae.$Q.ERROR)),Z=!b.find((e=>e.status));return(0,g.jsx)(u,{children:(0,g.jsxs)(p,{children:[f&&(0,g.jsx)(o.A,{alignItems:"center",justifyContent:"center",height:"100%",children:(0,g.jsx)(a.A,{})}),!f&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(o.A,{gap:"0.75rem",children:(0,g.jsx)(s.Op,{...e,children:(0,g.jsx)(ce,{type:n,onTypeChange:(e,t)=>c(t),onSubmit:e=>{e.amount&&b.length&&v()},zaps:b,currentZap:S,onRetrySend:W,isLoaded:y})})}),(0,g.jsx)(ve,{target:w}),(0,g.jsx)(Ue,{recipients:b,isNewZap:Z,onRestartZap:I}),(0,g.jsx)(mt,{logs:$})]}),(0,g.jsx)("div",{id:"send",role:"button",onClick:v,style:{display:"none"}}),S&&(0,g.jsx)(ut,{open:Boolean(S),currentZap:S,onClose:k,onDone:C,zaps:b}),(0,g.jsx)(xt,{seconds:R,onClose:E,open:R>0}),(0,g.jsx)(ft,{open:z,onClose:N,hasErrors:D})]})})}}}]);
//# sourceMappingURL=42.212ec60e.chunk.js.map